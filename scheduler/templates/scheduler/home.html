{% extends "base.html" %}

{% block title %}Dashboard Â· School Timetable{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">Dashboard</h1>
    <p class="text-muted mb-0">Overview of classes, teachers and timetables.</p>
  </div>
  <div>
    {% if user.profile.role == "ADMIN" %}
      <a href="{% url 'timetable_create' %}" class="btn btn-primary btn-pill">
        <i class="ri-add-line me-1"></i> New Timetable
      </a>
    {% endif %}
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-md-4">
    <div class="stat-card d-flex justify-content-between align-items-center">
      <div>
        <div class="stat-label">Total Classes</div>
        <div class="stat-value">{{ total_classes }}</div>
      </div>
      <i class="ri-building-2-line stat-icon"></i>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card d-flex justify-content-between align-items-center">
      <div>
        <div class="stat-label">Total Teachers</div>
        <div class="stat-value">{{ total_teachers }}</div>
      </div>
      <i class="ri-team-line stat-icon"></i>
    </div>
  </div>
  <div class="col-md-4">
    <div class="stat-card d-flex justify-content-between align-items-center">
      <div>
        <div class="stat-label">Active Timetables</div>
        <div class="stat-value">{{ total_timetables }}</div>
      </div>
      <i class="ri-calendar-schedule-line stat-icon"></i>
    </div>
  </div>
</div>

<h6 class="mb-3 text-muted text-uppercase" style="letter-spacing:.08em;font-size:.8rem;">
  Recent Timetables
</h6>

<div class="table-responsive">
  <table class="table align-middle mb-0">
    <thead>
    <tr>
      <th>Class</th>
      <th>Section</th>
      <th>Academic Year</th>
      <th>Created By</th>
      <th>Updated</th>
      <th class="text-end">Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for tt in recent_timetables %}
      <tr>
        <td>{{ tt.school_class }}</td>
        <td>{{ tt.section }}</td>
        <td>{{ tt.year }}</td>
        <td>{{ tt.created_by }}</td>
        <td>{{ tt.updated_at|date:"d M Y, H:i" }}</td>
        <td class="text-end">
          <a href="{% url 'timetable_detail' tt.id %}" class="btn btn-sm btn-outline-primary btn-pill">
            <i class="ri-eye-line me-1"></i> View
          </a>
        </td>
      </tr>
    {% empty %}
      <tr>
        <td colspan="6" class="text-center text-muted py-4">
          No timetables created yet.
          {% if user.profile.role == "ADMIN" %}
            <a href="{% url 'timetable_create' %}">Create the first one</a>.
          {% endif %}
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
